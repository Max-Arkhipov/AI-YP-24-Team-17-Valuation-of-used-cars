# Сервис для предсказания стоимости легкового автомобиля с пробегом
## Описание структуры проекта проекта:
```
deployment/
├── backend/                      # Директория с кодом FastAPI-сервиса
│   ├── app/
│   │   ├── __init__.py           # Инициализация пакета
│   │   ├── main.py               # Главный файл запуска FastAPI
│   │   ├── models.py             # Определение схем данных (Pydantic)
│   │   ├── routers/
│   │   │   ├── __init__.py       # Инициализация роутеров
│   │   │   ├── api.py            # Основные API-эндпоинты
│   │   ├── services.py           # Логика обработки данных и работы с ML-моделями
│   │   ├── utils.py              # (в разработке) Утилиты 
│   ├── tests/                    # Тесты для FastAPI-сервиса
│   │   ├── test_endpoints.py     # (в разработке) Тесты эндпоинтов
│   │   ├── test_models.py        # (в разработке) Тесты работы с моделями
│   ├── requirements.txt          # Зависимости Python для backend
│   └── Dockerfile                # (в разработке) Dockerfile для FastAPI-сервиса
│
├── frontend/                     # Директория с кодом Streamlit-приложения
│   ├── app.py                    # Главный файл запуска Streamlit
│   ├── pages/                    # Поддержка многостраничного интерфейса
│   │   ├── eda.py                # Страница для анализа данных
│   │   ├── training.py           # Страница для обучения моделей
│   │   ├── inference.py          # Страница для инференса
│   ├── utils/                    # Утилиты для работы с API
│   │   ├── api_client.py         # Клиент для взаимодействия с FastAPI
│   ├── requirements.txt          # Зависимости Python для frontend
│   └── Dockerfile                # (в разработке) Dockerfile для Streamlit-приложения
│
├── logstash/                     # Директория для настройки логирования
│   ├── logstash.conf             # (в разработке) Конфигурация Logstash
│   ├── Dockerfile                # (в разработке) Dockerfile для Logstash
│
├── logs/                         # Папка для хранения логов (игнорируется в Git)
│   └── app.log                   # (в разработке) Лог-файл с событиями приложения
│
├── assets/                       # Медиафайлы для документации
│   ├── frontend-demo.gif         # GIF-анимация работы Streamlit
│   └── backend-demo.gif          # GIF-анимация работы FastAPI
│
├── docker-compose.yml            # (в разработке) Docker-compose для запуска всех сервисов
├── README.md                     # Документация проекта
├── REPORT.md                     # Отчет о проекте
└── .gitignore                    # Список файлов/директорий, игнорируемых Git
```
## Описание функционала api / streamlit-приложения
Приложение принимает на вход датасет, обрабатывает его 
и дает основную аналитику по загруженным данным.
Для загруженного датасета и указанных гиперпараметров 
производит обучение линейных моделей, 
отображает список обученных моделей и кривые обучения. 
Для обученных моделей приложение дает предсказания.
## Краткая инструкция по использованию приложения:
1. Для запуска приложения необходимо запустить серверы:  
 - python -m streamlit run deployment/frontend/app.py
 - deployment/deployment/backend/app/main.py
```python
if __name__ == "__main__":
    uvicorn.run("main:app", host="127.0.0.1", port=8000, reload=True)
```
2. Работа с сервисом начинается с загрузки датасета. 
Для этого необходимо перейти в навигации в раздел 
"Анализ данных", выбрать файл 
[data.csv](https://drive.google.com/file/d/1LEESxc01wd-u2-pu5bLzXiQ6g0lwAK8i/view?usp=sharing), 
загрузить данные.  
После загрузки данных приложение выводит общую информацию по датасету
и предоставляет возможность отправки датасета в backend и предобработки данных.
После предобработки приложение предоставляет небольшую аналитику полученных данных.
3. Обучение моделей осуществляется в соответствующем разделе приложения.
 Доступно для обучения 3 типа моделей:
 - ohe: модель включающая в себя OneHotEncoding категориальных признаков
 - poly: модель дополнительно использует полиномиальные признаки
 - full: модель дополнительно включает логарифмирование целевой переменной  
Для модели необходимо выбрать идентификатор и параметр альфа для Ridge-регрессии  
Для построения кривой обучения необходимо обновить список моделей 
и выбрать необходимую для просмотра модель.
4. Для получения предсказаний необходимо выбрать модель и загрузить файл json. Например:
```
{"Unnamed: 0": 12,
 "url_car": "https://auto.ru/cars/used/sale/volkswagen/passat/1125187282-4f4c6274/",
 "car_make": "Volkswagen",
 "car_model": "Passat",
 "car_gen": "B7",
 "car_type": "Седан",
 "car_compl": "1.8 AMT (152 л.с.)",
 "ann_date": "2024-11-22",
 "ann_id": 1125187282,
 "car_price": 999000,
 "ann_city": "Белгород",
 "link_cpl": "https://auto.ru/catalog/cars/volkswagen/passat/7150225/7150227/specifications/7150227_7150236_7150232/",
 "avail": "В наличии",
 "year": 2011,
 "mileage": 225000,
 "color": "синий",
 "eng_size": 1.8,
 "eng_power": 152,
 "eng_power_kw": 0.0,
 "eng_type": "Бензин",
 "pow_resrv": 0.0,
 "options": "Comfortline",
 "transmission": "роботизированная",
 "drive": "передний",
 "st_wheel": "Левый",
 "condition": "Не требует ремонта",
 "count_owner": "3 или более",
 "original_pts": "Оригинал",
 "customs": "Растаможен",
 "url_compl": "https://auto.ru/catalog/cars/volkswagen/passat/7150225/7150227/specifications/7150227_7150236_7150232/",
 "state_mark": "Германия",
 "class_auto": "D",
 "door_count": 4,
 "seat_count": 5,
 "long": 4769,
 "widht": 1820,
 "height": 1470,
 "clearence": 155.0,
 "v_bag": 565.0,
 "v_tank": 70.0,
 "curb_weight": 1514.0,
 "gross_weight": 2050.0,
 "front_brakes": "дисковые",
 "rear_brakes": "дисковые",
 "max_speed": 214.0,
 "acceleration": 8.8,
 "fuel_cons": 5.6,
 "fuel_brand": "АИ-95",
 "engine_loc1": "переднее",
 "engine_loc2": "поперечное",
 "turbocharg": "турбонаддув",
 "max_torq": 250.0,
 "cyl_count": 4.0}
```