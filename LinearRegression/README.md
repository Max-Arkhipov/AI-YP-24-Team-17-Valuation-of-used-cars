# Linear_Regression

## Результаты работы

### Предобработка данных и EDA

- В первую очередь был осуществлен первичный анализ данных: вывели различные части датасета, определили типы полей и наличие в них пропусков.

- После данные были разделены на тестовый и тренировочный датасет. А также были созданы копии тренировочного и тестового датасетов для сопоставления по характеристикам после преобразований. Все дальнейшие преобразования данных проводились на основе исследования тренировочного датасета.  
  
- На следующем этапе из датасета были удалены поля с единственным категориальны значением, а также "технические" поля содержащие описания и ссылки на наборы данных: 'Unnamed: 0', 'url_car', 'ann_id', 'ann_date', 'ann_city', 'avail', 'original_pts', 'customs', 'link_cpl', 'eng_power_kw', 'pow_resrv', 'options', 'condition', 'url_compl'

- По результатам анализа данных в качестве основной стратегии было принято заполнение данных медианами и модами по различным группировкам полей: 'car_make', 'car_model', 'car_gen', 'car_type', 'class_auto', 'eng_type'. Были написаны функции, преобразующие датасет по каждой из группировок. Однако после было принято решение создать отдельные датасеты для каждой из группировок (для медиан и мод в одном датасете). Данное решение позволило значительно ускорить обработку данных, сделало код более читаемым.  

- После проведена обработка поля 'car_type' и проведена замена пропусков в полях 'eng_size', 'class_auto', 'clearence', 'v_bag', 'v_tank', 'curb_weight', 'gross_weight', 'rear_brakes', 'max_speed', 'acceleration', 'fuel_cons', 'fuel_brand', 'engine_loc1', 'engine_loc2', 'turbocharg', 'max_torq', 'cyl_count'. Для каждого поля выбиралась отдельная стратегия для замены пропусков. Так для замены пропусков в классе автомобиля дополнительно к заменам по группам была написана функция опредяющая по длине и типу кузова автомобиля наиболее близкий для него в этой группе класс.

- Заменили числами количество владельцев.  

- Затем удалили из тренировочного датасета объекты с одинаковым признаковым описанием, обновили индексы строк.

- Построили графики `pairplot` из библиотеки `seabron` для тренировочного и тестового датасета. Были сделаны следующие выводы:
    - На основе распределений можно предположить связь признаков с целевой переменной. В некоторых случаях (например связь между ценой и пробегом) можно предположить полиномиальную зависимость между полями.
    - На основе распределений можно выдвинуть гипотезу о корреляциях признаков: 'eng_power', 'eng_v', 'max_torq'.
      
- Построили тепловую карту `heatmap` из библиотеки `seabron` для отображения корреляций тренировочного датасета. Из тепловой карты следует, что наибольшая зависимость наблюдается между таргетом и признаком 'eng_power'. На тепловой карте подтверждается зависимость между признаками 'eng_power', 'eng_v', 'max_torq'. Кроме того, видим сильную корреляцию между снаряженной и максимальной массой (0,96), удалили максимальную массу.

- Для того, чтобы сравнить распределения тестового и тренировочного набора данных построены дополнительные графики отображающие данные на одном графическом элементе. Данные, представленные на графике `kdeplot` библиотеки `seabron`, показывают высокую схожесть распределения признаков датасета.

- Также построена тепловая карта корреляций категориальных признаков и таргета. Из карты можно сделать следующие выводы:
    -  наиболее значимым категориальным признаком в модели является марка автомобиля;
    -  модель автомобиля, комплектация и поколение очень сильно коррелируют с другими полями датасета. При кодировании категориальных признаков мы откажемся от их использования в модели.
 
- Изначально существовало предположение о том, что модель будет выдавать значительные ошибки и будет плохо обучаться на электрокарах (отсутствуют ряд признаков автомобилей с двигателями внутреннего сгорания, а также имеют иные моментные характеристики двигателя). Однако, предположение оказалось неверным, электрокары были включены в модель.

### Модель только на вещественных признаках

- Обучили классическую линейную регрессию. Получили результат:
    - Значение MAE для трейна:  1675641.5593488005
    - Значение MAE для теста:   1696678.7327414209  
      ********************
    - Значение MSE для трейна:  22508196297509.62
    - Значение MSE для теста:   37710658414114.125  
      ********************
    - Значение R^2 для трейна:  0.39778360565231974
    - Значение R^2 для теста:   0.3347738238735709  
      ********************
    - Значения кросс-валидации:
    - [0.5308367  0.52757372 0.40358797 0.36552103 0.31936942 0.31440924 0.48876838]
    - Среднее кросс-валидации:  0.42144
      ********************
    - Модель далека от совершенства, предсказывает цену посредственно

- Стандартизировали классическую линейную регрессию. Получили следующий результат:
    - Значение MAE для трейна:  1675641.5593488067
    - Значение MAE для теста:   1696678.7327414267
      ********************
    - Значение MSE для трейна:  22508196297509.63
    - Значение MSE для теста:   37710658414114.16
      ********************
    - Значение R^2 для трейна:  0.3977836056523196
    - Значение R^2 для теста:   0.33477382387357046
      ********************
    - Значения кросс-валидации:
    - [0.5308367  0.52757372 0.40358797 0.36552103 0.31936942 0.31440924 0.48876838]
    - Среднее кросс-валидации:  0.42144
      ********************
    - Каких-либо значимых изменений качества модели стандартизация не дала
    - Наиболее информативным оказался признак max_power.
    - Проведена стандартизация признаков, последующие модели на вещественных признаках обучаются на них.
      
- Обучили Lasso-регрессию:
    - Значение MAE для трейна:  1675638.9202538035
    - Значение MAE для теста:   1696676.228148525
      ********************
    - Значение MSE для трейна:  22508196297624.523
    - Значение MSE для теста:   37710665156505.25
      ********************
    - Значение R^2 для трейна:  0.39778360564924553
    - Значение R^2 для теста:   0.3347737049359748
      ********************
    - Значения кросс-валидации:
    - [0.53083699 0.52757376 0.4035879  0.365521   0.31936951 0.31440904 0.48876871]
    - Среднее кросс-валидации:  0.42144
      ********************
    - Качество модели практически не изменилось
    - L1-регуляризация с параметрами по умолчанию не занулила никакие веса

- Перебором по сетке (c 10-ю фолдами) подобрали оптимальные параметры для Lasso-регрессии:
    - Получили: alpha = 742400
      ********************
    - Значение MAE для трейна:  1364467.5374631593
    - Значение MAE для теста:   1400425.0897267708
      ********************
    - Значение MSE для трейна:  25048688553012.777
    - Значение MSE для теста:   42042145008565.266
      ********************
    - Значение R^2 для трейна:  0.32981165153591674
    - Значение R^2 для теста:   0.25836523316354565
      ********************
    - Значения кросс-валидации:
    - [0.4779158  0.44187701 0.32789246 0.29210588 0.28936879 0.23479454 0.45416893]
    - Среднее кросс-валидации:  0.35973
      ********************
    - При регуляризации не занулились веса следующих признаков: 'eng_power', 'cyl_count', 'mileage'
      
- Перебором по сетке (c 10-ю фолдами) подобрали оптимальные параметры для ElasticNet-регрессии:
    - Получили: alpha = 2.2, l1_ratio = 0.06
      ********************
    - Значение MAE для трейна:  1430170.607668681
    - Значение MAE для теста:   1465998.0489198808
      ********************
    - Значение MSE для трейна:  26414641396186.64
    - Значение MSE для теста:   44064773514032.63
      ********************
    - Значение R^2 для трейна:  0.2932650004763584
    - Значение R^2 для теста:   0.22268552129957075
      ********************
    - Значения кросс-валидации:
    - [0.44576722 0.39865045 0.28620379 0.2588744  0.26416404 0.19393834 0.42279781]
    - Среднее кросс-валидации:  0.32434
 
- Регуляризация не внесла какого-либо значимого прогресса в качество предсказаний модели. Обработаем категориальные признаки

### Добавляем категориальные фичи

- Исключили из модели поля: 'car_model', 'car_gen', 'car_compl'
- Закодировали категориальные фичи методом OneHot-кодирования
- Подобрали параметр регуляризации alpha для гребневой (ridge) регрессии:

    - Получили: alpha = 2450
    - Значение MAE для трейна:  1139611.9523276095
    - Значение MAE для теста:   1162561.7578565588
      ********************
    - Значение MSE для трейна:  10668682219894.746
    - Значение MSE для теста:   17919830321001.324
      ********************
    - Значение R^2 для трейна:  0.7145548557519429
    - Значение R^2 для теста:   0.6838893643709885
      ********************
    - Значения кросс-валидации:
    - [0.73831945 0.73019957 0.79903153 0.76877272 0.46606582 0.77578974 0.1163189 ]
    - Среднее кросс-валидации:  0.62779
      ********************
    - Качество предсказаний значительно улучшилось

### Решаем бизнес-задачу
- Бизнес-модель: доля предсказаний, отличающихся не более чем на 10% от реальной цены.

- Модель:  Линейная регрессия
    - Значение BM для трейна:  0.2166095890410959
    - Значение BM для теста:   0.225
      
- Модель:  Линейная регрессия со стандартизированными параметрами
    - Значение BM для трейна:  0.2166095890410959
    - Значение BM для теста:   0.225
 
- Модель:  Lasso()
    - Значение BM для трейна:  0.2166095890410959
    - Значение BM для теста:   0.225

- Модель:  Lasso(alpha=55000)
    - Значение BM для трейна:  0.20753424657534247
    - Значение BM для теста:   0.236
 
- Модель:  ElasticNet(alpha=0.89, l1_ratio=0.49)
    - Значение BM для трейна:  0.23544520547945205
    - Значение BM для теста:   0.262
 
- Модель:  Ridge(alpha=484.1)
    - Значение BM для трейна:  0.2761986301369863
    - Значение BM для теста:   0.321
 
- Лучшей с точки зрения бизнес-модели является модель Ridge(alpha=484.1), построенная на категориальных признаках, для тестовых данных 32.1% предсказаний отличаются не более 10% от реальной цены.

- Хотелось попробовать добавить в модель полиномиальных признаков, судя по графикам некоторые признаки имели схожую с квадратичной зависимость с таргетом. К сожалению не хватило времени, обязательно вернусь к этому вопросу, когда станет немного больше свободного времени.
